stages:
  - publish_build_to_pre_qa

publish_build_to_pre_qa:
  stage: publish_build_to_pre_qa
  image: python:3.8-alpine
  artifacts:
    when: always
    paths:
      - artifacts/*
  script:
    - mkdir -p artifacts
    - pip install requests
    - VERSION=$(git tag --sort=-creatordate | head -n 1)
    - echo "Build version: $VERSION"
    # Upload ESS-ContentUpdate build to Pre-QA
    - python security_content_automation/publish_build_to_pre_qa/publish_build_to_pre_qa.py --version $VERSION --builds DA-ESS-ContentUpdate
    # Upload SSA-Content build to Pre-QA
    - python security_content_automation/publish_build_to_pre_qa/publish_build_to_pre_qa.py --version $VERSION --builds SSA_Content
  after_script:
    - cp publish_build_to_pre_qa.log artifacts/publish_build_to_pre_qa.log
